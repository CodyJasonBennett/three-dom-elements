{"version":3,"file":"index.modern.js","sources":["../src/objects/DOMElement.js","../src/constants.js","../src/renderers/DOMContext.js"],"sourcesContent":["import {\n  Mesh,\n  PlaneGeometry,\n  MeshBasicMaterial,\n  NoBlending,\n  DoubleSide,\n} from 'three';\nimport { CSS3DObject } from 'three/examples/jsm/renderers/CSS3DRenderer.js';\nimport { cssFactor } from '../constants.js';\n\nclass DOMElement extends Mesh {\n  constructor(\n    context,\n    domElement,\n    { elementWidth = 768, width = 1, height = 0.75 } = {}\n  ) {\n    const geometry = new PlaneGeometry(width, height);\n    const material = new MeshBasicMaterial({\n      opacity: 0,\n      color: 0xffffff,\n      blending: NoBlending,\n      side: DoubleSide,\n    });\n\n    super(geometry, material);\n\n    this.domElement = domElement;\n    this.aspectRatio = height / width;\n    this.elementWidth = elementWidth;\n    this.elementHeight = this.elementWidth * this.aspectRatio;\n    this.width = width;\n    this.height = height;\n\n    this.resizeDomElement();\n\n    this.cssObject = new CSS3DObject(this.domElement);\n    this.cssObject.scale.multiplyScalar(cssFactor / (this.elementWidth / this.width));\n\n    this.addEventListener('added', () => context.cssScene.add(this.cssObject));\n    this.addEventListener('removed', () => context.cssScene.remove(this.cssObject));\n\n    this.update = this.update.bind(this);\n  }\n\n  resizeDomElement() {\n    this.domElement.style.width = `${this.elementWidth}px`;\n    this.domElement.style.height = `${this.elementHeight}px`;\n  }\n\n  setDomElement(domElement) {\n    if (this.domElement.parentNode) {\n      this.domElement.parentNode.removeChild(this.domElement);\n    }\n\n    this.domElement = domElement;\n    this.cssObject.element = domElement;\n\n    this.resizeDomElement();\n  }\n\n  update() {\n    this.updateMatrixWorld();\n    const worldMatrix = this.matrixWorld;\n\n    worldMatrix.decompose(this.position, this.quaternion, this.scale);\n\n    this.cssObject.quaternion.copy(this.quaternion);\n    this.cssObject.position.copy(this.position).multiplyScalar(cssFactor);\n\n    const scaleFactor =\n      this.elementWidth / (this.geometry.parameters.width * this.scale.x);\n\n    this.cssObject.scale.multiplyScalar(cssFactor / scaleFactor);\n    this.cssObject.visible = this.visible;\n  }\n}\n\nexport default DOMElement;\n","export const cssFactor = 100;\r\n","import { PerspectiveCamera, Scene } from 'three';\r\nimport { CSS3DRenderer } from 'three/examples/jsm/renderers/CSS3DRenderer.js';\r\nimport { cssFactor } from '../constants.js';\r\n\r\nclass DOMContext {\r\n  constructor(camera) {\r\n    this.enabled = true;\r\n\r\n    this.cssRenderer = new CSS3DRenderer();\r\n    this.domElement = this.cssRenderer.domElement;\r\n\r\n    this.cssCamera = new PerspectiveCamera(\r\n      camera.fov,\r\n      camera.aspect,\r\n      camera.near * cssFactor,\r\n      camera.far * cssFactor\r\n    );\r\n    this.camera = camera;\r\n\r\n    this.cssScene = new Scene();\r\n\r\n    this.update = this.update.bind(this);\r\n  }\r\n\r\n  setSize(width, height) {\r\n    this.cssRenderer.setSize(width, height);\r\n    this.cssCamera.aspect = width / height;\r\n    this.cssCamera.updateProjectionMatrix();\r\n  }\r\n\r\n  update() {\r\n    this.cssCamera.quaternion.copy(this.camera.quaternion);\r\n    this.cssCamera.position.copy(this.camera.position).multiplyScalar(cssFactor);\r\n\r\n    if (this.enabled) {\r\n      this.cssScene.traverse(child => {\r\n        if (!child.update) return;\r\n\r\n        child.update();\r\n      });\r\n    }\r\n\r\n    this.cssRenderer.render(this.cssScene, this.cssCamera);\r\n  }\r\n}\r\n\r\nexport default DOMContext;\r\n"],"names":["DOMElement","Mesh","constructor","context","domElement","elementWidth","width","height","super","PlaneGeometry","MeshBasicMaterial","opacity","color","blending","NoBlending","side","DoubleSide","this","aspectRatio","elementHeight","resizeDomElement","cssObject","CSS3DObject","scale","multiplyScalar","addEventListener","cssScene","add","remove","update","bind","style","setDomElement","parentNode","removeChild","element","updateMatrixWorld","matrixWorld","decompose","position","quaternion","copy","geometry","parameters","x","visible","DOMContext","camera","enabled","cssRenderer","CSS3DRenderer","cssCamera","PerspectiveCamera","fov","aspect","near","far","Scene","setSize","updateProjectionMatrix","traverse","child","render"],"mappings":"wOAUA,MAAMA,UAAmBC,EACvBC,YACEC,EACAC,GACAC,aAAEA,EAAe,IAAjBC,MAAsBA,EAAQ,EAA9BC,OAAiCA,EAAS,KAAS,IAUnDC,MARiB,IAAIC,EAAcH,EAAOC,GACzB,IAAIG,EAAkB,CACrCC,QAAS,EACTC,MAAO,SACPC,SAAUC,EACVC,KAAMC,KAKRC,KAAKb,WAAaA,EAClBa,KAAKC,YAAcX,EAASD,EAC5BW,KAAKZ,aAAeA,EACpBY,KAAKE,cAAgBF,KAAKZ,aAAeY,KAAKC,YAC9CD,KAAKX,MAAQA,EACbW,KAAKV,OAASA,EAEdU,KAAKG,mBAELH,KAAKI,UAAY,IAAIC,EAAYL,KAAKb,YACtCa,KAAKI,UAAUE,MAAMC,eCpCA,KDoC4BP,KAAKZ,aAAeY,KAAKX,QAE1EW,KAAKQ,iBAAiB,QAAS,IAAMtB,EAAQuB,SAASC,IAAIV,KAAKI,YAC/DJ,KAAKQ,iBAAiB,UAAW,IAAMtB,EAAQuB,SAASE,OAAOX,KAAKI,YAEpEJ,KAAKY,OAASZ,KAAKY,OAAOC,KAAKb,MAGjCG,mBACEH,KAAKb,WAAW2B,MAAMzB,MAAS,GAAEW,KAAKZ,iBACtCY,KAAKb,WAAW2B,MAAMxB,OAAU,GAAEU,KAAKE,kBAGzCa,cAAc5B,GACRa,KAAKb,WAAW6B,YAClBhB,KAAKb,WAAW6B,WAAWC,YAAYjB,KAAKb,YAG9Ca,KAAKb,WAAaA,EAClBa,KAAKI,UAAUc,QAAU/B,EAEzBa,KAAKG,mBAGPS,SACEZ,KAAKmB,oBACenB,KAAKoB,YAEbC,UAAUrB,KAAKsB,SAAUtB,KAAKuB,WAAYvB,KAAKM,OAE3DN,KAAKI,UAAUmB,WAAWC,KAAKxB,KAAKuB,YACpCvB,KAAKI,UAAUkB,SAASE,KAAKxB,KAAKsB,UAAUf,eCnEvB,KDwErBP,KAAKI,UAAUE,MAAMC,eCxEA,KDsEnBP,KAAKZ,cAAgBY,KAAKyB,SAASC,WAAWrC,MAAQW,KAAKM,MAAMqB,KAGnE3B,KAAKI,UAAUwB,QAAU5B,KAAK4B,SErElC,MAAMC,EACJ5C,YAAY6C,GACV9B,KAAK+B,SAAU,EAEf/B,KAAKgC,YAAc,IAAIC,EACvBjC,KAAKb,WAAaa,KAAKgC,YAAY7C,WAEnCa,KAAKkC,UAAY,IAAIC,EACnBL,EAAOM,IACPN,EAAOO,ODbY,ICcnBP,EAAOQ,KDdY,ICenBR,EAAOS,KAETvC,KAAK8B,OAASA,EAEd9B,KAAKS,SAAW,IAAI+B,EAEpBxC,KAAKY,OAASZ,KAAKY,OAAOC,KAAKb,MAGjCyC,QAAQpD,EAAOC,GACbU,KAAKgC,YAAYS,QAAQpD,EAAOC,GAChCU,KAAKkC,UAAUG,OAAShD,EAAQC,EAChCU,KAAKkC,UAAUQ,yBAGjB9B,SACEZ,KAAKkC,UAAUX,WAAWC,KAAKxB,KAAK8B,OAAOP,YAC3CvB,KAAKkC,UAAUZ,SAASE,KAAKxB,KAAK8B,OAAOR,UAAUf,eDhC9B,KCkCjBP,KAAK+B,SACP/B,KAAKS,SAASkC,SAASC,IAChBA,EAAMhC,QAEXgC,EAAMhC,WAIVZ,KAAKgC,YAAYa,OAAO7C,KAAKS,SAAUT,KAAKkC"}