{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import {\n  PerspectiveCamera,\n  Scene,\n  MeshBasicMaterial,\n  NoBlending,\n  DoubleSide,\n  PlaneGeometry,\n  Mesh,\n  Vector3,\n  Quaternion,\n} from 'three';\nimport { CSS3DRenderer, CSS3DObject } from 'three/examples/jsm/renderers/CSS3DRenderer.js';\n\nconst cssFactor = 100;\n\nclass DOMContext {\n  constructor(camera) {\n    this.enabled = true;\n\n    this.cssRenderer = new CSS3DRenderer();\n    this.domElement = this.cssRenderer.domElement;\n\n    this.cssCamera = new PerspectiveCamera(\n      camera.fov,\n      camera.aspect,\n      camera.near * cssFactor,\n      camera.far * cssFactor\n    );\n    this.camera = camera;\n\n    this.cssScene = new Scene();\n\n    this.update = this.update.bind(this);\n  }\n\n  setSize(width, height) {\n    this.cssRenderer.setSize(width, height);\n    this.cssCamera.aspect = width / height;\n    this.cssCamera.updateProjectionMatrix();\n  }\n\n  update() {\n    this.cssCamera.quaternion.copy(this.camera.quaternion);\n    this.cssCamera.position.copy(this.camera.position).multiplyScalar(cssFactor);\n\n    if (this.enabled) {\n      this.cssScene.traverse(child => {\n        if (!child.update) return;\n\n        child.update();\n      });\n    }\n\n    this.cssRenderer.render(this.cssScene, this.cssCamera);\n  }\n}\n\nclass DOMElement extends Mesh {\n  constructor(\n    context,\n    domElement,\n    { elementWidth = 768, width = 1, height = 0.75 } = {}\n  ) {\n    const geometry = new PlaneGeometry(width, height);\n    const material = new MeshBasicMaterial({\n      opacity: 0,\n      color: 0xffffff,\n      blending: NoBlending,\n      side: DoubleSide,\n    });\n\n    super(geometry, material);\n\n    this.domElement = domElement;\n    this.aspectRatio = height / width;\n    this.elementWidth = elementWidth;\n    this.elementHeight = this.elementWidth * this.aspectRatio;\n    this.width = width;\n    this.height = height;\n\n    this.resizeDomElement();\n\n    this.cssObject = new CSS3DObject(this.domElement);\n    this.cssObject.scale\n      .multiplyScalar(cssFactor / (this.elementWidth / this.width));\n\n    this.addEventListener('added', () => context.cssScene.add(this.cssObject));\n    this.addEventListener('removed', () => context.cssScene.remove(this.cssObject));\n\n    this.update = this.update.bind(this);\n  }\n\n  resizeDomElement() {\n    this.domElement.style.width = `${this.elementWidth}px`;\n    this.domElement.style.height = `${this.elementHeight}px`;\n  }\n\n  setDomElement(domElement) {\n    if (this.domElement.parentNode) {\n      this.domElement.parentNode.removeChild(this.domElement);\n    }\n\n    this.domElement = domElement;\n    this.cssObject.element = domElement;\n\n    this.resizeDomElement();\n  }\n\n  update() {\n    this.updateMatrixWorld();\n    const worldMatrix = this.matrixWorld;\n\n    const position = new Vector3();\n    const scale = new Vector3();\n    const quaternion = new Quaternion();\n    worldMatrix.decompose(position, quaternion, scale);\n\n    this.cssObject.quaternion.copy(quaternion);\n    this.cssObject.position.copy(position).multiplyScalar(cssFactor);\n\n    const scaleFactor =\n      this.elementWidth / (this.geometry.parameters.width * scale.x);\n\n    this.cssObject.scale.multiplyScalar(cssFactor / scaleFactor);\n  }\n}\n\nexport { DOMContext, DOMElement };\n"],"names":["DOMContext","camera","this","enabled","cssRenderer","CSS3DRenderer","domElement","cssCamera","PerspectiveCamera","fov","aspect","near","far","cssScene","Scene","update","bind","setSize","width","height","updateProjectionMatrix","quaternion","copy","position","multiplyScalar","traverse","child","render","DOMElement","context","elementWidth","geometry","PlaneGeometry","material","MeshBasicMaterial","opacity","color","blending","NoBlending","side","DoubleSide","_this","aspectRatio","elementHeight","resizeDomElement","cssObject","CSS3DObject","scale","addEventListener","add","remove","style","setDomElement","parentNode","removeChild","element","updateMatrixWorld","worldMatrix","matrixWorld","Vector3","Quaternion","decompose","parameters","x","Mesh"],"mappings":"kFAeMA,aACJ,WAAYC,GACVC,KAAKC,SAAU,EAEfD,KAAKE,YAAc,IAAIC,gBACvBH,KAAKI,WAAaJ,KAAKE,YAAYE,WAEnCJ,KAAKK,UAAY,IAAIC,oBACnBP,EAAOQ,IACPR,EAAOS,OAXK,IAYZT,EAAOU,KAZK,IAaZV,EAAOW,KAETV,KAAKD,OAASA,EAEdC,KAAKW,SAAW,IAAIC,QAEpBZ,KAAKa,OAASb,KAAKa,OAAOC,KAAKd,iCAGjCe,QAAA,SAAQC,EAAOC,GACbjB,KAAKE,YAAYa,QAAQC,EAAOC,GAChCjB,KAAKK,UAAUG,OAASQ,EAAQC,EAChCjB,KAAKK,UAAUa,4BAGjBL,OAAA,WACEb,KAAKK,UAAUc,WAAWC,KAAKpB,KAAKD,OAAOoB,YAC3CnB,KAAKK,UAAUgB,SAASD,KAAKpB,KAAKD,OAAOsB,UAAUC,eA9BrC,KAgCVtB,KAAKC,SACPD,KAAKW,SAASY,SAAS,SAAAC,GAChBA,EAAMX,QAEXW,EAAMX,WAIVb,KAAKE,YAAYuB,OAAOzB,KAAKW,SAAUX,KAAKK,iBAI1CqB,sBACJ,WACEC,EACAvB,wBACmD,SAAjDwB,aAAAA,aAAe,UAAKZ,MAAAA,aAAQ,QAAGC,OAAAA,aAAS,MAEpCY,EAAW,IAAIC,gBAAcd,EAAOC,GACpCc,EAAW,IAAIC,oBAAkB,CACrCC,QAAS,EACTC,MAAO,SACPC,SAAUC,aACVC,KAAMC,eANR,OASAC,cAAMV,EAAUE,UAEX3B,WAAaA,EAClBmC,EAAKC,YAAcvB,EAASD,EAC5BuB,EAAKX,aAAeA,EACpBW,EAAKE,cAAgBF,EAAKX,aAAeW,EAAKC,YAC9CD,EAAKvB,MAAQA,EACbuB,EAAKtB,OAASA,EAEdsB,EAAKG,mBAELH,EAAKI,UAAY,IAAIC,cAAYL,EAAKnC,YACtCmC,EAAKI,UAAUE,MACZvB,eAvEW,KAuEiBiB,EAAKX,aAAeW,EAAKvB,QAExDuB,EAAKO,iBAAiB,QAAS,kBAAMnB,EAAQhB,SAASoC,IAAIR,EAAKI,aAC/DJ,EAAKO,iBAAiB,UAAW,kBAAMnB,EAAQhB,SAASqC,OAAOT,EAAKI,aAEpEJ,EAAK1B,OAAS0B,EAAK1B,OAAOC,uPAG5B4B,iBAAA,WACE1C,KAAKI,WAAW6C,MAAMjC,MAAWhB,KAAK4B,kBACtC5B,KAAKI,WAAW6C,MAAMhC,OAAYjB,KAAKyC,sBAGzCS,cAAA,SAAc9C,GACRJ,KAAKI,WAAW+C,YAClBnD,KAAKI,WAAW+C,WAAWC,YAAYpD,KAAKI,YAG9CJ,KAAKI,WAAaA,EAClBJ,KAAK2C,UAAUU,QAAUjD,EAEzBJ,KAAK0C,sBAGP7B,OAAA,WACEb,KAAKsD,oBACL,IAAMC,EAAcvD,KAAKwD,YAEnBnC,EAAW,IAAIoC,UACfZ,EAAQ,IAAIY,UACZtC,EAAa,IAAIuC,aACvBH,EAAYI,UAAUtC,EAAUF,EAAY0B,GAE5C7C,KAAK2C,UAAUxB,WAAWC,KAAKD,GAC/BnB,KAAK2C,UAAUtB,SAASD,KAAKC,GAAUC,eAzGzB,KA8GdtB,KAAK2C,UAAUE,MAAMvB,eA9GP,KA4GZtB,KAAK4B,cAAgB5B,KAAK6B,SAAS+B,WAAW5C,MAAQ6B,EAAMgB,SAhEzCC"}