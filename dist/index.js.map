{"version":3,"file":"index.js","sources":["../src/objects/DOMElement.js","../src/constants.js","../src/renderers/DOMContext.js"],"sourcesContent":["import {\n  Mesh,\n  PlaneGeometry,\n  MeshBasicMaterial,\n  NoBlending,\n  DoubleSide,\n} from 'three';\nimport { CSS3DObject } from 'three/examples/jsm/renderers/CSS3DRenderer.js';\nimport { cssFactor } from '../constants.js';\n\nclass DOMElement extends Mesh {\n  constructor(\n    context,\n    domElement,\n    { elementWidth = 768, width = 1, height = 0.75 } = {}\n  ) {\n    const geometry = new PlaneGeometry(width, height);\n    const material = new MeshBasicMaterial({\n      opacity: 0,\n      color: 0xffffff,\n      blending: NoBlending,\n      side: DoubleSide,\n    });\n\n    super(geometry, material);\n\n    this.domElement = domElement;\n    this.aspectRatio = height / width;\n    this.elementWidth = elementWidth;\n    this.elementHeight = this.elementWidth * this.aspectRatio;\n    this.width = width;\n    this.height = height;\n\n    this.resizeDomElement();\n\n    this.cssObject = new CSS3DObject(this.domElement);\n    this.cssObject.scale.multiplyScalar(cssFactor / (this.elementWidth / this.width));\n\n    this.addEventListener('added', () => context.cssScene.add(this.cssObject));\n    this.addEventListener('removed', () => context.cssScene.remove(this.cssObject));\n\n    this.update = this.update.bind(this);\n  }\n\n  resizeDomElement() {\n    this.domElement.style.width = `${this.elementWidth}px`;\n    this.domElement.style.height = `${this.elementHeight}px`;\n  }\n\n  setDomElement(domElement) {\n    if (this.domElement.parentNode) {\n      this.domElement.parentNode.removeChild(this.domElement);\n    }\n\n    this.domElement = domElement;\n    this.cssObject.element = domElement;\n\n    this.resizeDomElement();\n  }\n\n  update() {\n    this.updateMatrixWorld();\n    const worldMatrix = this.matrixWorld;\n\n    worldMatrix.decompose(this.position, this.quaternion, this.scale);\n\n    this.cssObject.quaternion.copy(this.quaternion);\n    this.cssObject.position.copy(this.position).multiplyScalar(cssFactor);\n\n    const scaleFactor =\n      this.elementWidth / (this.geometry.parameters.width * this.scale.x);\n\n    this.cssObject.scale.multiplyScalar(cssFactor / scaleFactor);\n    this.cssObject.visible = this.visible;\n  }\n}\n\nexport default DOMElement;\n","export const cssFactor = 100;\r\n","import { PerspectiveCamera, Scene } from 'three';\r\nimport { CSS3DRenderer } from 'three/examples/jsm/renderers/CSS3DRenderer.js';\r\nimport { cssFactor } from '../constants.js';\r\n\r\nclass DOMContext {\r\n  constructor(camera) {\r\n    this.enabled = true;\r\n\r\n    this.cssRenderer = new CSS3DRenderer();\r\n    this.domElement = this.cssRenderer.domElement;\r\n\r\n    this.cssCamera = new PerspectiveCamera(\r\n      camera.fov,\r\n      camera.aspect,\r\n      camera.near * cssFactor,\r\n      camera.far * cssFactor\r\n    );\r\n    this.camera = camera;\r\n\r\n    this.cssScene = new Scene();\r\n\r\n    this.update = this.update.bind(this);\r\n  }\r\n\r\n  setSize(width, height) {\r\n    this.cssRenderer.setSize(width, height);\r\n    this.cssCamera.aspect = width / height;\r\n    this.cssCamera.updateProjectionMatrix();\r\n  }\r\n\r\n  update() {\r\n    this.cssCamera.quaternion.copy(this.camera.quaternion);\r\n    this.cssCamera.position.copy(this.camera.position).multiplyScalar(cssFactor);\r\n\r\n    if (this.enabled) {\r\n      this.cssScene.traverse(child => {\r\n        if (!child.update) return;\r\n\r\n        child.update();\r\n      });\r\n    }\r\n\r\n    this.cssRenderer.render(this.cssScene, this.cssCamera);\r\n  }\r\n}\r\n\r\nexport default DOMContext;\r\n"],"names":["DOMElement","context","domElement","elementWidth","width","height","geometry","PlaneGeometry","material","MeshBasicMaterial","opacity","color","blending","NoBlending","side","DoubleSide","_this","aspectRatio","elementHeight","resizeDomElement","cssObject","CSS3DObject","scale","multiplyScalar","addEventListener","cssScene","add","remove","update","bind","this","style","setDomElement","parentNode","removeChild","element","updateMatrixWorld","matrixWorld","decompose","position","quaternion","copy","parameters","x","visible","Mesh","camera","enabled","cssRenderer","CSS3DRenderer","cssCamera","PerspectiveCamera","fov","aspect","near","far","Scene","setSize","updateProjectionMatrix","traverse","child","render"],"mappings":"kFAUMA,sBACJ,WACEC,EACAC,wBACmD,SAAjDC,aAAAA,aAAe,UAAKC,MAAAA,aAAQ,QAAGC,OAAAA,aAAS,MAEpCC,EAAW,IAAIC,gBAAcH,EAAOC,GACpCG,EAAW,IAAIC,oBAAkB,CACrCC,QAAS,EACTC,MAAO,SACPC,SAAUC,aACVC,KAAMC,eANR,OASAC,cAAMV,EAAUE,UAEXN,WAAaA,EAClBc,EAAKC,YAAcZ,EAASD,EAC5BY,EAAKb,aAAeA,EACpBa,EAAKE,cAAgBF,EAAKb,aAAea,EAAKC,YAC9CD,EAAKZ,MAAQA,EACbY,EAAKX,OAASA,EAEdW,EAAKG,mBAELH,EAAKI,UAAY,IAAIC,cAAYL,EAAKd,YACtCc,EAAKI,UAAUE,MAAMC,eCpCA,KDoC4BP,EAAKb,aAAea,EAAKZ,QAE1EY,EAAKQ,iBAAiB,QAAS,kBAAMvB,EAAQwB,SAASC,IAAIV,EAAKI,aAC/DJ,EAAKQ,iBAAiB,UAAW,kBAAMvB,EAAQwB,SAASE,OAAOX,EAAKI,aAEpEJ,EAAKY,OAASZ,EAAKY,OAAOC,uPAG5BV,iBAAA,WACEW,KAAK5B,WAAW6B,MAAM3B,MAAW0B,KAAK3B,kBACtC2B,KAAK5B,WAAW6B,MAAM1B,OAAYyB,KAAKZ,sBAGzCc,cAAA,SAAc9B,GACR4B,KAAK5B,WAAW+B,YAClBH,KAAK5B,WAAW+B,WAAWC,YAAYJ,KAAK5B,YAG9C4B,KAAK5B,WAAaA,EAClB4B,KAAKV,UAAUe,QAAUjC,EAEzB4B,KAAKX,sBAGPS,OAAA,WACEE,KAAKM,oBACeN,KAAKO,YAEbC,UAAUR,KAAKS,SAAUT,KAAKU,WAAYV,KAAKR,OAE3DQ,KAAKV,UAAUoB,WAAWC,KAAKX,KAAKU,YACpCV,KAAKV,UAAUmB,SAASE,KAAKX,KAAKS,UAAUhB,eCnEvB,KDwErBO,KAAKV,UAAUE,MAAMC,eCxEA,KDsEnBO,KAAK3B,cAAgB2B,KAAKxB,SAASoC,WAAWtC,MAAQ0B,KAAKR,MAAMqB,KAGnEb,KAAKV,UAAUwB,QAAUd,KAAKc,YA/DTC,sCELvB,WAAYC,GACVhB,KAAKiB,SAAU,EAEfjB,KAAKkB,YAAc,IAAIC,gBACvBnB,KAAK5B,WAAa4B,KAAKkB,YAAY9C,WAEnC4B,KAAKoB,UAAY,IAAIC,oBACnBL,EAAOM,IACPN,EAAOO,ODbY,ICcnBP,EAAOQ,KDdY,ICenBR,EAAOS,KAETzB,KAAKgB,OAASA,EAEdhB,KAAKL,SAAW,IAAI+B,QAEpB1B,KAAKF,OAASE,KAAKF,OAAOC,KAAKC,iCAGjC2B,QAAA,SAAQrD,EAAOC,GACbyB,KAAKkB,YAAYS,QAAQrD,EAAOC,GAChCyB,KAAKoB,UAAUG,OAASjD,EAAQC,EAChCyB,KAAKoB,UAAUQ,4BAGjB9B,OAAA,WACEE,KAAKoB,UAAUV,WAAWC,KAAKX,KAAKgB,OAAON,YAC3CV,KAAKoB,UAAUX,SAASE,KAAKX,KAAKgB,OAAOP,UAAUhB,eDhC9B,KCkCjBO,KAAKiB,SACPjB,KAAKL,SAASkC,SAAS,SAAAC,GAChBA,EAAMhC,QAEXgC,EAAMhC,WAIVE,KAAKkB,YAAYa,OAAO/B,KAAKL,SAAUK,KAAKoB"}